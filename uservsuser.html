<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>User vs User</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen">
  <header class="bg-gray-800 p-6 shadow-md">
    <h1 class="text-3xl font-bold text-center">User vs User</h1>
  </header>

  <main class="p-6 max-w-5xl mx-auto space-y-6">
    <a href="index.html" class="inline-block bg-gray-700 hover:bg-gray-600 text-white py-2 px-4 rounded-lg">← Back to Home</a>

    <!-- Filters -->
    <section class="bg-gray-800 rounded-2xl p-6 shadow-md">
      <h2 class="text-xl font-bold mb-4 border-b border-gray-600 pb-2">Filters</h2>
      <div class="grid gap-4 sm:grid-cols-3">
        <div>
          <label class="block text-sm mb-1" for="yearSel">Year</label>
          <select id="yearSel" class="w-full bg-gray-900 border border-gray-700 rounded p-2"></select>
        </div>
        <div>
          <label class="block text-sm mb-1" for="homeSel">Home</label>
          <select id="homeSel" class="w-full bg-gray-900 border border-gray-700 rounded p-2"></select>
        </div>
        <div>
          <label class="block text-sm mb-1" for="awaySel">Away</label>
          <select id="awaySel" class="w-full bg-gray-900 border border-gray-700 rounded p-2"></select>
        </div>
      </div>
    </section>

    <!-- Table -->
    <section class="bg-gray-800 rounded-2xl p-6 shadow-md">
      <h2 class="text-xl font-bold mb-4 border-b border-gray-600 pb-2">Matchups</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-left table-auto border border-gray-600">
          <thead class="bg-gray-700">
            <tr>
              <th class="p-2">Year</th>
              <th class="p-2">Home</th>
              <th class="p-2">Away</th>
              <th class="p-2">Winner</th>
              <th class="p-2">Score</th>
            </tr>
          </thead>
          <tbody id="uvuBody" class="text-gray-100"></tbody>
        </table>
      </div>
    </section>
    <!-- All-Time Head-to-Head -->
    <section class="bg-gray-800 rounded-2xl p-6 shadow-md mt-6">
        <h2 class="text-xl font-bold mb-4 border-b border-gray-600 pb-2">All-Time Head-to-Head</h2>
        <div class="overflow-x-auto">
        <table class="w-full text-left table-auto border border-gray-600">
            <thead class="bg-gray-700">
            <tr>
                <th class="p-2">Name</th>
                <th class="p-2">All-time versus</th>
                <th class="p-2">Record</th>
            </tr>
            </thead>
            <tbody id="h2hBody" class="text-gray-100"></tbody>
        </table>
        </div>
    </section>
  
  </main>

  <footer class="bg-gray-800 p-4 text-center text-sm text-gray-400 mt-10">
    EA CFB 25 Dynasty League
  </footer>

  <script>
    const SHEET_ID = "1YelSwe2frFL_FvB3ul8bmZrWCYyULFCZqbfx6oO_Fr4"; // <-- set to the correct league’s sheet ID
    const TAB = "UserInfo";

    const yearSel = document.getElementById("yearSel");
    const homeSel = document.getElementById("homeSel");
    const awaySel = document.getElementById("awaySel");
    const bodyEl  = document.getElementById("uvuBody");

    let ALL = [];
    let YEARS = [], HOMES = [], AWAYS = [];

    fetch(`https://opensheet.elk.sh/1rKNSb7t1_kLLpDn3lJEuXrzN3P1uMfAVqHQFG4hnGYM/UserInfo`)
    .then(r => r.json())
    .then(rows => {
      ALL = rows;

      // (existing setup for filters, render(), etc.)
      YEARS = ["All", ...Array.from(new Set(rows.map(r => r.Year).filter(Boolean))).sort().reverse()];
      HOMES = ["All", ...Array.from(new Set(rows.map(r => r.Home).filter(Boolean))).sort()];
      AWAYS = ["All", ...Array.from(new Set(rows.map(r => r.Away).filter(Boolean))).sort()];
      fillSelect(yearSel, YEARS);
      fillSelect(homeSel, HOMES);
      fillSelect(awaySel, AWAYS);
      if (YEARS.length > 1) yearSel.value = YEARS[1];
      render();

      // NEW: build & render all-time head-to-head
      renderH2H(rows);
    })
    .catch(err => {
      console.error("UserInfo fetch error:", err);
      bodyEl.innerHTML = `<tr><td colspan="5" class="p-2 text-red-400">Couldn’t load data.</td></tr>`;
      const h2h = document.getElementById("h2hBody");
      if (h2h) h2h.innerHTML = `<tr><td colspan="3" class="p-2 text-red-400">Couldn’t load H2H data.</td></tr>`;
    });

  // --- NEW: All-time H2H helpers ---
  function renderH2H(rows){
    const h2hBody = document.getElementById("h2hBody");
    if (!h2hBody) return;

    // Collect unique user names from Home/Away
    const users = Array.from(new Set(
      rows.flatMap(r => [r.Home, r.Away]).filter(Boolean)
    )).sort();

    // Precompute wins A over B
    const wins = new Map(); // key "A||B" -> count
    for (const r of rows) {
      const home = r.Home?.trim(); 
      const away = r.Away?.trim();
      const winner = r.Winner?.trim();
      if (!home || !away || !winner) continue;
      // winner must be one of the participants
      if (winner !== home && winner !== away) continue;
      const loser = (winner === home) ? away : home;
      const key = `${winner}||${loser}`;
      wins.set(key, (wins.get(key) || 0) + 1);
    }

    // Build directional rows: for each A vs B, record = winsA-winsB
    let rowsHtml = "";
    for (const a of users) {
      for (const b of users) {
        if (a === b) continue;
        const wA = wins.get(`${a}||${b}`) || 0;
        const wB = wins.get(`${b}||${a}`) || 0;
        // Hide pairs with zero games if you want:
        if (wA + wB === 0) continue;
        rowsHtml += `
          <tr class="border-t border-gray-600">
            <td class="p-2">${escapeHtml(a)}</td>
            <td class="p-2">${escapeHtml(b)}</td>
            <td class="p-2">${wA}&ndash;${wB}</td>
          </tr>
        `;
      }
    }

    h2hBody.innerHTML = rowsHtml || `<tr><td colspan="3" class="p-2 text-gray-400">No head-to-head games yet.</td></tr>`;
  }

  function escapeHtml(s){ return String(s||"").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])); }
</script>
</body>
</html>
